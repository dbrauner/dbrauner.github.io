/*!
 * @copyright@
 */
sap.ui.define(['jquery.sap.global','sap/ui/commons/DropdownBox','sap/ui/commons/Label','sap/ui/commons/Splitter','sap/ui/commons/layout/AbsoluteLayout','sap/ui/core/ListItem','sap/ui/core/search/OpenSearchProvider','./Tag','./TagCloud','./library','sap/ui/ux3/NavigationItem','sap/ui/ux3/Shell'],function(q,D,L,S,A,a,O,T,b,l,N,c){"use strict";var d=function(t,v,e){var f=this;function g(p){return p.split('/').slice(0,-1).join('/')+'/';}var B=window.location.href;if(B.indexOf('#')>=0){B=B.slice(0,B.indexOf('#'));}this.sBaseUrl=g(B);this.sBasePathname=g(window.location.pathname);this._iPendingCalls=0;this._mBestMatchingPage={};this._aTopLevelNavItems=[];this._aThemes=e||["sap_bluecrystal","sap_goldreflection","sap_hcb"];this._sTheme=this._aThemes[0];this._sCurrentContent=null;this._mAliases={};this._bIgnoreIFrameOnLoad=false;this._sTitleStr=t;this._sVersionStr=v;this._sSelectedWorkSetItem=null;d.getInstance=q.sap.getter(this);q(window).bind('hashchange',function(){var h=window.location.hash;q.sap.log.debug("hashchange occured, current='"+f._sCurrentContent+"', new='"+h+"'");if(h&&h!="#"+f._sCurrentContent){q.sap.log.info("navigate to "+h);f.navigateTo(h,true);}});};d.getInstance=function(){var t=q.sap.getObject("top.sap.ui.demokit.DemokitApp");if(t&&t!=d){return t.getInstance();}};d.prototype.calcRelativeUrl=function(u){return u.indexOf(this.sBaseUrl)==0?u.substring(this.sBaseUrl.length):null;};d.prototype.registerPageForType=function(u,C){this._mBestMatchingPage[C[0]]=u;};d.prototype.findPageForType=function(t){return this._mBestMatchingPage[t]||"docs/api/symbols/"+t+".html";};d.prototype._addPendingCall=function(){this._iPendingCalls++;};d.prototype._removePendingCall=function(){this._iPendingCalls--;};d.prototype.addIndex=function(i,s){s=s||{};var t=this;var o={id:"mi-"+i,text:s.caption||i,newWindow:s.newWindow,visible:(typeof s.visible==="boolean")?s.visible:true,themable:s.themable||false};this._aTopLevelNavItems.push(o);this._createWorksetItem(o);if(s.index){if(s.extend){s.extend(s.index,function(e){t._setIndexData(i,e);});}else{t._setIndexData(i,s.index);}}else if(s.url){this._loadIndexFromUrl(i,s.url,s.transformer,s.extend);}};d.prototype._loadIndexFromUrl=function(i,u,t,E){var f=this;q.ajax({url:u,dataType:u.slice(-4)==".xml"?"xml":"json",error:function(x,s,e){f._removePendingCall();q.sap.log.error("failed to load index '"+i+"' from '"+u+"': "+s+", "+e);var o=f._findIndexById(i);if(o){o.navItem.setVisible(false);}},success:function(o,s,x){var I=t?t.call(this,o):o;if(E){E(I,function(o){f._removePendingCall();f._setIndexData(i,o);});}else{f._removePendingCall();f._setIndexData(i,I);}}});this._addPendingCall();};d.prototype._setIndexData=function(I,o){var t=this;function p(f){n++;if(f.ref&&f.controls){var C=q.isArray(f.controls)?f.controls:f.controls.split(/,/);t.registerPageForType(f.ref,C);}if(f.alias&&f.ref){var g=f.alias.split(",");for(var i=0;i<g.length;i++){t._mAliases[g[i]]=f.ref;}}if(f.links){for(var i=0;i<f.links.length;i++){p(f.links[i]);}}}var e=this._findIndexById(I);if(e){e.ref=o.ref;e.links=o;var n=0;p(o);e._iTreeSize=n;this._createNavigationTree(e);e.navItem.setEnabled(!!e._oTree);e.navItem.setHref(o.ref);}};d.prototype._findIndexById=function(I){for(var i=0;i<this._aTopLevelNavItems.length;i++){var t=this._aTopLevelNavItems[i];if(t.id==="mi-"+I){return t;}}};d.prototype.getInitialPage=function(s,e){var i=s,h=window.location.hash,m=q.sap.getUriParameters().get("optimized-module-set");function f(u){return/^([a-zA-Z0-9-_]+\/)*[a-zA-Z0-9-_.]+\.html(#.*)?$/.test(u);}if(h){h=h.indexOf("#")===0?h.substring(1):h;if(f(h)){i=h;}}if(e&&m){i="customize.html?data="+m;}return i;};d.prototype.getPagesForCategory=function(C){var t=this._findIndexById("controls");if(!t||!t.links){return d.RETRY_LATER;}var p=C.split('/');var o=t.links;for(var i=0;i<p.length;i++){var P=p[i];for(var j=0;j<o.links.length;j++){if(P==o.links[j].text){break;}}if(j==o.links.length){return[];}o=o.links[j];}return o.links||[];};d.RETRY_LATER=-2;d.prototype.findIndexForPage=function(u){function f(n,u){if(u&&n.ref&&u.indexOf(n.ref)===0){return true;}if(n.links){for(var j=0;j<n.links.length;j++){if(f(n.links[j],u)){return true;}}}return false;}for(var i=0;i<this._aTopLevelNavItems.length;i++){if(this._aTopLevelNavItems[i].links&&f(this._aTopLevelNavItems[i].links,u)){return i;}}if(this._aTopLevelNavItems.length===0||this._iPendingCalls>0){return d.RETRY_LATER;}else{q.sap.log.error("could not find "+u+" in nav tree");return-1;}};d.DEFAULT_TLN_ITEM=0;d.prototype._createNavigationTree=function(t){var e=this;var n=0;function s(E){e.navigateTo(E.getSource()._ref_);}function f(g,h,j){for(var i=0;i<h.length;i++){var k=new sap.ui.commons.TreeNode({text:h[i].text,tooltip:h[i].tooltip,expanded:j<1,selectable:!!h[i].ref,icon:h[i].ico||null,selected:s});k._ref_=h[i].ref;g.addNode(k);n++;if(h[i].links&&h[i].links.length>0){f(k,h[i].links,j+1);}}}if(t._oTree){return;}var o=new sap.ui.commons.Tree(t.id+"-index",{showHeader:true,width:"100%",height:"100%",showHorizontalScrollbar:true});o.addStyleClass("sapUiTreeWithHeader");f(o,t.links.links,0);t._oTree=o;t._iTreeSize=n;};d.prototype._createWorksetItem=function(t){var n=t.navItem=new N({key:t.id,text:t.text,href:"#"+t.ref,visible:t.visible,enabled:false});n._itemData_=t;if(this._oShell){this._oShell.addWorksetItem(n);}};d.prototype.createUI=function(s,I){var e;var t=this;var f="theme/img/themeswitch_";var g=d.THEMES;this._oThemeSwitch=new D({change:[this._handleThemeChanged,this],items:q.map(this._aThemes,function(i){return new a({text:g[i],key:i});}),value:g[this._sTheme]});this._oThemeSwitchPopup=new sap.ui.ux3.ToolPopup({title:"Select a theme",icon:f+"regular.png",iconHover:f+"hover.png",iconSelected:f+"selected.png",content:[this._oThemeSwitch],initialFocus:this._oThemeSwitch});var C=new sap.ui.core.HTML("content",{content:"<iframe id=\"content\" name=\"content\" src=\"about:blank\" frameborder=\"0\" onload=\"sap.ui.demokit.DemokitApp.getInstance().onContentLoaded();\"></iframe>"});var o=this._oSidePanelLayout=new A();sap.ui.Device.os.name==sap.ui.Device.os.OS.IOS?e=true:e=false;var v=new sap.ui.commons.Link({text:this._sVersionStr,tooltip:"Open Version Info",press:function(){t.navigateTo("versioninfo.html");}});var h=this._oShell=new c({appTitle:this._sTitleStr,showLogoutButton:false,showFeederTool:false,applyContentPadding:false,showSearchTool:s,fullHeightContent:true,toolPopups:[this._oThemeSwitchPopup],search:function(E){t.navigateTo("search.html?q="+encodeURIComponent(E.getParameter("text")));t._oShell._getSearchTool().close();},worksetItemSelected:function(E){var n=E.getParameter("item");if(n.getEnabled()){var i=n._itemData_;if(i.newWindow){E.preventDefault();}t.navigateTo(i.ref,null,null,i.newWindow);}else{E.preventDefault();}},content:[new S("demokitSplitter",{width:"100%",height:"100%",splitterPosition:"0%",splitterBarVisible:false,firstPaneContent:[o],secondPaneContent:[C],showScrollBars:e})],headerItems:[v]});this._oShell.addStyleClass("sapDkShell");function j(K){var m=new b({minFontSize:15,maxFontSize:30,press:function(E){var n=sap.ui.getCore().byId(E.getParameter("tagId")).getText();h.fireSearch({text:n});}}).addStyleClass("grTagCloud");for(var i=0;i<K.length;i++){m.addTag(new T({text:K[i].tag,weight:K[i].score}));}h._getSearchTool&&h._getSearchTool().addContent(m);}if(s){var k=h.getSearchField();k.setEnableListSuggest(true);k.setShowListExpander(false);k.setVisibleItemCount(5);k.setSearchProvider(new O({suggestType:"json",suggestUrl:"suggest?q={searchTerms}"}));q.ajax({url:"keywords?kind=tags&max=50",dataType:"json",success:function(i,m,x){if(i&&i[0]&&i[0].success&&i[0].keywords&&i[0].keywords.length){j(i[0].keywords);k.setWidth("80%");}}});}q.each(this._aTopLevelNavItems,function(i,m){h.addWorksetItem(m.navItem);});this.navigateTo(I);q(function(){q("body").append("<div id=\"logo\"><img id=\"logoico\"><img id=\"logotxt\"></div>");q("#logoico").attr("src","resources/sap/ui/core/mimes/logo/icotxt_white_220x72_blue.png").addClass("sapUiImg");});};d.prototype.placeAt=function(i){this._oShell.placeAt(i);};d.prototype.onContentLoaded=function(e){var t=this;var C=q("#content")[0].contentWindow;var i=this.calcRelativeUrl(C.location.href);if(i&&!this._bIgnoreIFrameOnLoad){this.navigateTo(i,true,true);window.location.replace("#"+i);}this._applyTheme();this._bIgnoreIFrameOnLoad=false;q(C).bind("hashchange",function(){var i=t.calcRelativeUrl(C.location.href);if(i&&!t._bIgnoreIFrameOnLoad){t.navigateTo(i,true,true);window.location.hash=i;}t._bIgnoreIFrameOnLoad=false;});};d.prototype.navigateTo=function(n,s,e,f){var t=this;var p=n.indexOf("#")===0?n.substring(1):n;var r=this._mAliases[p];if(r&&p!=r){e=false;p=r;}if(this._sCurrentContent==p){return;}var C=q("#content")[0];var o=C&&C.contentWindow;var g=this.findIndexForPage(p);if(f){window.open(p,"_blank");return;}if(!o||g===d.RETRY_LATER){setTimeout(function(){t.navigateTo(p,s,e);},200);return;}var h=g>=0?this._aTopLevelNavItems[g]:null;var j=this._oShell;var k=sap.ui.getCore().byId("demokitSplitter");if(h&&h._iTreeSize<=1){if(k.getSplitterBarVisible()){var m=k.getSplitterPosition();if(m!=="0%"){k._oldPos=m;k.setSplitterPosition("0%");}k.setSplitterBarVisible(false);}}else{if(!k.getSplitterBarVisible()){var m=k._oldPos||"20%";k.setSplitterPosition(m);k.setSplitterBarVisible(true);}}this._sCurrentContent=p;function u(p,P,B){if(P){if(B&&P.getSelectedNode&&P.getSelectedNode()){P.getSelectedNode().setIsSelected(false);}var E=P.getNodes();for(var i=0;i<E.length;i++){if(E[i]._ref_&&E[i]._ref_.indexOf(p)>=0){E[i].setIsSelected(true);var G=P;while(G instanceof sap.ui.commons.TreeNode){G.expand();G=G.getParent();}return E[i];}else{var H=u(p,E[i],false);if(H){return H;}}}}return null;}var v=null;var w=h&&h.navItem;if(w&&this._sSelectedWorkSetItem!=w.getId()){w.setVisible(true);j.setSelectedWorksetItem(w);this._oSidePanelLayout.removeAllContent();if(h._oTree){this._oSidePanelLayout.addContent(h._oTree);}v=u(p,h._oTree,true);if(h.themable){if(j.getToolPopups().length==0){j.addToolPopup(this._oThemeSwitchPopup);}}else{j.removeAllToolPopups();}}else{v=u(p,this._oSidePanelLayout.getContent()[0],true);if(!v&&p.indexOf("#")>0){var x=p.substr(0,p.indexOf("#")-1);v=u(x,this._oSidePanelLayout.getContent()[0]);}}sap.ui.getCore().applyChanges();this._sSelectedWorkSetItem=j.getSelectedWorksetItem();if(!s){window.location.hash=p;}if(!e){this._bIgnoreIFrameOnLoad=true;var y=p&&p.match(/\/sap\/me?\//);var z=p&&p.indexOf("sap/m/demokit")!==-1;var F=(y&&!z)?"?sap-ui-xx-fakeOS=ios":"";o.location.replace((p.indexOf("/")==0?"":this.sBasePathname)+p+F);}};d.THEMES={"sap_bluecrystal":"Blue Crystal","sap_goldreflection":"Gold Reflection","sap_hcb":"High Contrast Black"};d.prototype._handleThemeChanged=function(e){var n=e.getParameter("newValue");for(var x in d.THEMES){if(d.THEMES[x]==n){this._sTheme=x;this._applyTheme();e.getSource().getParent().close();break;}}};d.prototype._applyTheme=function(){var C=q("#content")[0].contentWindow;var I=this.calcRelativeUrl(C.location.href);var t=I?this.findIndexForPage(I):-1;if(I&&t>=0&&this._aTopLevelNavItems[t].themable&&C&&C.sap&&C.sap.ui&&C.sap.ui.getCore){var e=I.match(/\/sap\/me?\//);var m=e?["sap_bluecrystal"]:this._aThemes;var s=C.sap.ui.demokit&&C.sap.ui.demokit._supportedThemes?C.sap.ui.demokit._supportedThemes:m;var f=this._oThemeSwitch.getItems();for(var i=0;i<f.length;i++){f[i].setEnabled(q.inArray(f[i].getKey(),s)>=0);}if(q.inArray(this._sTheme,s)<0){this._sTheme=s[0];this._oThemeSwitch.setValue(d.THEMES[this._sTheme]);}C.sap.ui.getCore().applyTheme(this._sTheme);}};(function(){function r(o,s){if(o.ref&&o.resolve==="lib"){o.ref=s+o.ref;}if(o.links){for(var i=0;i<o.links.length;i++){r(o.links[i],s);}}}function m(n,o){if(n.key!=o.key||!o.links||o.links.length==0){return;}if(!n.links){n.links=o.links;return;}function e(g,k){for(var j=0;j<g.links.length;j++){if(g.links[j].key===k){return g.links[j];}}return null;}var s;for(var i=0;i<o.links.length;i++){s=o.links[i];if(!s.key){n.links.push(s);}else{var g=e(n,s.key);if(g){m(g,s);}else{n.links.push(s);}}}}function f(i,C,e,o){for(var j=0;j<e.length;j++){var g=o[e[j]];if(g&&g.docu){r(g.docu,g.libraryUrl);m(i,g.docu);}}C(i);}d.addReleaseNotesToDevGuide=function(I,u,t,e){if(!u){u="releasenotes.html";}if(!t){t="Release Notes";}if(!e){e=1;}function g(n){if(n&&n.links&&n.links.length>0){return n.links[0];}return null;}var o=I;for(var i=0;i<e;i++){o=g(o);}if(o){o.links=o.links||[];o.links.push({ref:u,text:t,alias:"releasenotes.html"});}return I;};d.extendDevGuide=function(I,C){q.sap.require("sap.ui.core.util.LibraryInfo");var g=new sap.ui.core.util.LibraryInfo();var u="discovery/all_libs";q.ajax({url:u,dataType:"json",error:function(x,s,e){q.sap.log.error("failed to load library list from '"+u+"': "+s+", "+e);C(I);},success:function(o,s,x){var e=o["all_libs"];if(!e){q.sap.log.error("failed to load library list from '"+u+"': "+s+", Data: "+e);C(I);return;}var h=0,j=e.length,k={},n=[],p;for(var i=0;i<j;i++){p=e[i].entry.replace(/\//g,".");n.push(p);g._getDocuIndex(p,function(E){k[E.library]=E;h++;if(h==j){f(I,C,n,k);}});}}});};})();return d;},true);
